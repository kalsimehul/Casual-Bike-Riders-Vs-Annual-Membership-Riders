---
title: "Casual Rider Habits Vs Annual Member Rider Habits"
subtitle: "Identifying and analyzing the difference between casual rider and annual rember rider for Cyclistic Bikes."
author: 
  - "Mehul Kalsi"
output: html_document
---
#Summary: Extracted previous 12 months of Cyclistic Bike Trip data from 09/2021 To 08/2022. Organized, transformed, and cleaned data in excel and converted to csv format. Wrangled data and combined into a single dataframe. Analyzed average ride_length,and the number of rides per day. Visualized data to identify pattern and relationships between attributes. 

```{r message=FALSE, warning=FALSE}
library("tidyverse")
library(lubridate)  #helps wrangle date attributes.
library(ggplot2)  # helps visualize data.
```

#=====================

# STEP 1: COLLECT DATA
#=====================
```{r message=FALSE, warning=FALSE}
YM202109 <- read_csv("202109-divvy-tripdata.csv")
YM202110 <- read_csv("202110-divvy-tripdata.csv")
YM202111 <- read_csv("202111-divvy-tripdata.csv")
YM202112 <- read_csv("202112-divvy-tripdata.csv")
YM202201 <- read_csv("202201-divvy-tripdata.csv")
YM202202 <- read_csv("202202-divvy-tripdata.csv")
YM202203 <- read_csv("202203-divvy-tripdata.csv")
YM202204 <- read_csv("202204-divvy-tripdata.csv")
YM202205 <- read_csv("202205-divvy-tripdata.csv")
YM202206 <- read_csv("202206-divvy-tripdata.csv")
YM202207 <- read_csv("202207-divvy-tripdata.csv")
YM202208 <- read_csv("202208-divvy-tripdata.csv")

```
#====================================================

# STEP 2: WRANGLE DATA AND COMBINE INTO A SINGLE FILE
#====================================================

```{r message=FALSE, warning=FALSE}
colnames(YM202208) #column names.
str(YM202208) ## Inspect the dataframes and look for incongruence.

# Stack individual quarter's data frames into one big data frame.
all_trips <- bind_rows(YM202109,YM202110,YM202111,YM202112,YM202201,YM202202,YM202203,YM202204,YM202205,YM202206,YM202207,YM202208)
```
#======================================================

# STEP 3: CLEAN UP AND ADD DATA TO PREPARE FOR ANALYSIS
#======================================================
```{r message=FALSE, warning=FALSE}
#Convert ride length from HH:MM to Seconds.
all_trips$ride_lengthv2 <- hms(all_trips$ride_length)
all_trips$ride_lengthv3 <- period_to_seconds(all_trips$ride_lengthv2)
#Dropped rows with null values.
 all_trips<-all_trips %>% 
   drop_na(ride_lengthv3)
 summary(all_trips$ride_lengthv3)
#Dropped all rows with ride length = 0 | > 86400
all_trips <- all_trips[all_trips$ride_lengthv3 != 0, ]
all_trips <- all_trips[all_trips$ride_lengthv3 <= 86400, ]
#removed temporary column
all_trips <- all_trips %>% select(-c(ride_lengthv2))

 library(lubridate)
 #new row that contains the start time for the trip.
all_trips$start_date <- as.Date(all_trips$started_at, format = "%m/%d/%y")
```
#=====================================

# STEP 4: CONDUCT DESCRIPTIVE ANALYSIS
#=====================================
```{r}
#Average ride_length for casual and member riders.
aggregate(all_trips$ride_lengthv3 ~ all_trips$member_casual, FUN = mean)
#Median ride_length for casual and member riders.
aggregate(all_trips$ride_lengthv3 ~ all_trips$member_casual, FUN = median)
#Max Ride_length.
aggregate(all_trips$ride_lengthv3 ~ all_trips$member_casual, FUN = max)
#Min Ride_length.
aggregate(all_trips$ride_lengthv3 ~ all_trips$member_casual, FUN = min)
# Looking at the average ride time by each day for members vs casual users.
aggregate(all_trips$ride_lengthv3 ~ all_trips$member_casual + all_trips$day_of_week, FUN = mean)
# Analyzing ridership data by type and weekday.
all_trips %>% mutate(weekday = wday(start_date, label = TRUE)) %>% group_by(member_casual, weekday) %>% summarise(number_of_rides = n(),average_duration = mean(ride_lengthv3)) %>% arrange(member_casual, weekday)
#Visualizing the number of rides by rider type.
all_trips %>% mutate(weekday = wday(start_date, label = TRUE)) %>% group_by(member_casual, weekday) %>% summarise(number_of_rides = n(),average_duration = mean(ride_lengthv3)) %>% arrange(member_casual, weekday) %>% ggplot(aes(x = weekday, y = number_of_rides, fill = member_casual)) + 
geom_col(position = "dodge")
#Visualizing the average duration for each member by weekday.
all_trips %>% mutate(weekday = wday(start_date, label = TRUE)) %>% group_by(member_casual, weekday) %>% summarise(number_of_rides = n(),average_duration = mean(ride_lengthv3)) %>% arrange(member_casual, weekday) %>% ggplot(aes(x = weekday, y = average_duration, fill = member_casual)) +
geom_col(position = "dodge")
```



